(()=>{"use strict";var e={446:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Chromosome=void 0;const n=s(660);class o extends n.default{constructor(e,t,s){super(),this.genes=[],this.fitness=0,this.randGene=t,this.randNum=s,this.genes=e,this.length=e.length}static generate(e,t,s){const n=[];for(let s=0;s<e;s++)n.push(t());return new o(n,t,s)}getFitness(){return this.fitness}setFitness(e){this.fitness=e,this.emit("update_fitness",e)}compare(e){let t=0;for(let s=0;s<Math.min(this.length,e.length);s++)t+=this.genes[s]!==e.genes[s]?1:0;return t}mutateWith(e=1/this.length,t){t(this,e)}crossoverWith(e,t){return t(this,e)}setGenes(e){this.genes=[...e]}getGenes(){return this.genes}copy(e){this.genes=e.genes.slice(),this.length=e.length,this.randGene=e.randGene,this.fitness=e.fitness}clone(){const e=o.generate(this.length,this.randGene,this.randNum);return e.copy(this),e}randomGene(){return this.randGene()}randomNumber(){return this.randNum()}}t.Chromosome=o},348:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.crossoverMethod=void 0,t.crossoverMethod={singlePoint:(e,t)=>{const s=Math.floor(e.randomNumber()*e.getGenes().length);return[[...e.getGenes().slice(0,s),...t.getGenes().slice(s)],[...t.getGenes().slice(0,s),...e.getGenes().slice(s)]]},twoPoint:(e,t)=>{const s=[],n=[],o=e.getGenes(),i=t.getGenes(),r=e.getGenes().length;let a=Math.floor(e.randomNumber()*r),l=Math.floor(e.randomNumber()*r);a>l&&([a,l]=[l,a]);for(let e=0;e<r;e++)s.push(e<a?o[e]:e<l?i[e]:o[e]),n.push(e<a?i[e]:e<l?o[e]:i[e]);return[s,n]},uniform:(e,t)=>{const s=[],n=[],o=e.getGenes(),i=t.getGenes(),r=e.getGenes().length;for(let t=0;t<r;t++){let r=e.randomNumber()<.5;s.push(r?i[t]:o[t]),n.push(r?o[t]:i[t])}return[s,n]},halfUniform:(e,t)=>{let s=[],n=[];const o=e.getGenes(),i=t.getGenes(),r=e.getGenes().length,a=[];for(let e=0;e<r;e++)o[e]!==i[e]&&a.push(e);const l=a.length;s=o.slice(),n=i.slice();for(let t=0;t<l/2;t++){let t=Math.floor(e.randomNumber()*a.length);s[a[t]]=i[a[t]],n[a[t]]=o[a[t]],a.splice(t,1)}return[s,n]},ordered:(e,t)=>{const s=[],n=[],o=e.getGenes(),i=t.getGenes(),r=e.getGenes().length;let a=Math.floor(e.randomNumber()*r),l=Math.floor(e.randomNumber()*r),h=a;a=Math.min(a,l),l=Math.max(h,l);for(let e=a;e<l;e++)s[e]=i[e],n[e]=o[e];for(let e=0;e<r;e++){if(-1===s.indexOf(o[e]))s[e]=o[e];else for(let t=0;t<r;t++)-1===s.indexOf(o[t])&&(s[e]=o[t]);if(-1===n.indexOf(i[e]))n[e]=i[e];else for(let t=0;t<i.length;t++)-1===n.indexOf(i[t])&&(n[e]=i[t])}return[s,n]}}},803:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Darwin=void 0;const n=s(446),o=s(348),i=s(666),r=s(675);t.Darwin=class{constructor(e){this.population=[],this.generation=0;const t=()=>{this.stats.needsUpdate=!0};this.params=Object.assign({crossoverRate:.7,mutationRate:1/e.populationSize,crossoverMethod:o.crossoverMethod.singlePoint,mutationMethod:i.mutationMethod.flip,eliteCount:Math.ceil(e.populationSize/25),eliteCopies:1,randomNumber:Math.random},e);for(let s=0;s<e.populationSize;s++){const e=n.Chromosome.generate(this.params.chromosomeLength,this.params.randomGene,this.params.randomNumber);e.on("update_fitness",t),this.population.push(e)}this.stats={fittest:this.population[0],averageFitness:0,totalFitness:0,fittestIndex:0,needsUpdate:!0}}duplicateElite(e){const{eliteCount:t,eliteCopies:s}=this.params;if(t>0){const n=this.getTopChromosomes(t);e.push(...n);for(let o=0;o<t;o++)for(let t=0;t<s;t++)e.push(n[o].clone())}}crossover(e){const{populationSize:t,crossoverRate:s,crossoverMethod:o,randomGene:i,randomNumber:r}=this.params;for(;e.length<t;)if(this.params.randomNumber()<s){const t=this.getRandomChromosome(),s=this.getRandomChromosome(),[a,l]=t.crossoverWith(s,o);e.push(new n.Chromosome(a,i,r),new n.Chromosome(l,i,r))}this.params.populationSize%2==1&&e.pop()}mutate(e){for(const t of e)t.mutateWith(this.params.mutationRate,this.params.mutationMethod)}updateFitness(e){for(let t=0;t<this.population.length;t++){const s=this.population[t];s.setFitness(e(s.getGenes()))}this.stats.needsUpdate=!0}mate(){const e=[];this.duplicateElite(e),this.crossover(e),this.mutate(e),this.population=e,this.generation+=1,this.updateStats(!0)}getPopulation(){return this.population}getChromosomeAt(e){return this.population[e]}getRandomChromosome(){if(this.updateStats(),0===this.stats.totalFitness)return this.population[Math.floor(this.params.randomNumber()*this.population.length)];const e=this.params.randomNumber()*this.stats.totalFitness;let t=0;for(let s=0;s<this.population.length;s++)if(t+=this.population[s].getFitness(),t>e)return this.population[s];return this.population[0]}getTopChromosomes(e){return r.selectKBest(this.population,e)}getAverageFitness(){return this.updateStats(),this.stats.averageFitness}getFittest(){return this.updateStats(),this.stats.fittest}getParams(){return this.params}getGeneration(){return this.generation}getStats(){return this.stats}updateStats(e=!1){if(e||this.stats.needsUpdate){let e=0,t=0,s=0;for(let n=0;n<this.population.length;n++){const o=this.population[n].getFitness();e+=o,o>t&&(t=o,s=n)}this.stats.totalFitness=e,this.stats.averageFitness=e/this.params.populationSize,this.stats.fittest=this.population[s].clone(),this.stats.fittestIndex=s,this.stats.needsUpdate=!1}}}},24:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MonkeyFactory=t.randChar=t.alphabet=void 0;const n=s(803);function o(){return t.alphabet[Math.floor(Math.random()*t.alphabet.length)]}function i(e,t){let s=0,n=Math.max(e.length,t.length)-Math.min(e.length,t.length);for(let n=0;n<Math.min(e.length,t.length);n++)s+=Number(e[n]!==t[n]);return s+n}t.alphabet=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","?","!",".","#","@","&","*","$","%","+","-","/","=","0","1","2","3","4","5","6","7","8","9","(",")",",","'",'"',":","_","-"],t.randChar=o,t.MonkeyFactory=class{constructor(e){this.params=Object.assign(Object.assign({},e),{randomGene:o})}*search(e){this.params.chromosomeLength=e.length;const t=new n.Darwin(this.params);for(;;){for(const s of t.getPopulation()){const n=i(s.getGenes().join(""),e);if(s.setFitness(Math.pow(2,e.length-n)),0===n)return{generation:t.getGeneration(),averageFitness:t.getAverageFitness(),fittest:s}}t.mate(),yield{averageFitness:t.getAverageFitness(),fittest:t.getFittest(),generation:t.getGeneration()}}}}},660:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.eventHandlers=new Map}on(e,t){var s;this.isListening(e)||this.eventHandlers.set(e,[]),null===(s=this.eventHandlers.get(e))||void 0===s||s.push(t)}isListening(e){return this.eventHandlers.has(e)}emit(e,t,s){var n;if(this.isListening(e))for(const o of null!==(n=this.eventHandlers.get(e))&&void 0!==n?n:[])o.call(s,t)}bindEvent(e,t){e.on(t,(e=>this.emit(t,e)))}removeListener(e){this.eventHandlers.delete(e)}removeListeners(){this.eventHandlers.clear()}}},666:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mutationMethod=void 0,t.mutationMethod={flip:(e,t)=>{const s=e.getGenes(),n=s.length;for(let o=0;o<n;o++)e.randomNumber()<t&&(s[o]=e.randomGene())},swap:(e,t)=>{const s=e.getGenes(),n=s.length;for(let o=0;o<n;o++)if(e.randomNumber()<t){const e=Math.floor(Math.random()*n);[s[o],s[e]]=[s[e],s[o]]}}}},675:(e,t)=>{function s(e,t=0,o=e.length-1){const i=e[Math.floor((t+o)/2)].getFitness();if(t<o){const r=n(e,t,o,i);s(e,t,r-1),s(e,r,o)}}function n(e,t,s,n){for(;t<=s;){for(;e[t].getFitness()>n;)t++;for(;e[s].getFitness()<n;)s--;t<=s&&([e[t],e[s]]=[e[s],e[t]],t++,s--)}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.selectKBest=void 0,t.selectKBest=function(e,t){return function(e,t,o=0,i=e.length-1){const r=e[Math.floor((o+i)/2)].getFitness();if(o<i){const a=n(e,o,i,r);s(e,o,a-1),a<t&&s(e,a,i)}}(e,t),e.slice(0,t)}}},t={};function s(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,s),i.exports}(()=>{const e=s(24),t=(e,t={},s={})=>{const n=document.createElement(e);for(const[e,s]of Object.entries(t))n[e]=s;for(const e in s){const t=s[e];void 0!==t&&(n.style[e]=t)}return n},n=(e,t)=>{for(const s of t)e.appendChild(s);return e},o=()=>t("br"),i=(e,s)=>{const o=t("input",s);var i;return{elem:n(t("div"),[(i=e,t("span",{textContent:i})),o]),value:()=>o.value}},r=t("input",{type:"text",value:"https://en.wikipedia.org/wiki/Genetic_algorithm"},{width:"400px"}),a=t("button",{textContent:"Go"}),l=t("p",{},{fontSize:"24px"}),h=t("div",{},{fontSize:"24px"}),u=i("Population",{type:"number",value:"200"}),p=i("Crossover rate",{type:"number",value:"0.7",min:"0",max:"1",step:"0.01"}),m=i("Mutation rate",{type:"number",value:"0.02",min:"0",max:"1",step:"0.01"}),c=i("Elite count",{type:"number",value:"15"}),d=i("Elite copies",{type:"number",value:"2"}),g=n(t("div",{},{width:"350px"}),[u.elem,p.elem,m.elem,c.elem,d.elem]);n(document.body,[r,a,o(),l,o(),h,o(),g]),a.addEventListener("click",(()=>{const t=r.value,s=t.split("").find((t=>!e.alphabet.includes(t)));if(s)alert(`The character '${s}' cannot be used`);else{const s=new e.MonkeyFactory({populationSize:parseInt(u.value()),chromosomeLength:t.length,crossoverRate:parseFloat(p.value()),mutationRate:parseFloat(m.value()),eliteCount:parseInt(c.value(),10),eliteCopies:parseInt(d.value(),10)}).search(t),n=()=>{const e=s.next();l.textContent=e.value.fittest.getGenes().join("");const o=Math.log2(e.value.fittest.getFitness())/t.length,i=Math.log2(e.value.averageFitness)/t.length;h.innerHTML=`generation: ${e.value.generation}</br>\n                average fitness: ${(100*i).toFixed(4)}% </br>\n                max fitness: ${(100*o).toFixed(4)}% `,e.done||requestAnimationFrame(n)};n()}}))})()})();